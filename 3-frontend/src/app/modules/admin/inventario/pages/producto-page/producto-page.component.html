<mat-drawer-container class="flex-auto h-full">
    <!-- Drawer -->
    <mat-drawer class="w-90" [mode]="'over'" #matDrawer autoFocus="false">
        <!-- Header -->
        <div class="flex items-center justify-between m-4 mr-3 sm:my-5">
            <!-- Title -->
            <div class="text-3xl font-semibold tracking-tight leading-8">Filtrar por:</div>
            <!-- Close Drawer -->
            <div>
                <button mat-icon-button (click)="matDrawer.close()">
                    <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                </button>
            </div>
        </div>
        <div class="flex flex-col flex-auto h-full dark:bg-default">
            <!-- Filtros -->
            <div class="flex flex-col flex-auto shrink-0 pt-6 bg-card dark:bg-transparent">

                <form class="flex flex-col px-6" [formGroup]="filtroProductoForm">

                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Código</mat-label>
                        <input matInput formControlName="codigo" maxlength="50" autocomplete="off">
                    </mat-form-field>

                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Nombre</mat-label>
                        <input matInput formControlName="nombre" maxlength="50" autocomplete="off">
                    </mat-form-field>

                    <!-- Categorías -->
                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Categorías</mat-label>
                        <mat-select [formControlName]="'categoria'" multiple #selectCategoriaItem>
                            <mat-select-trigger>
                                <ng-container *ngIf="selectCategoriaItem.value?.length > 0">
                                    <span *ngFor="let categoria of selectCategoriaItem.value; let i = index">
                                        <span class="color-indicator" [style.backgroundColor]="categoria?.color"></span>
                                        {{ categoria.nombre || '' }}<ng-container
                                            *ngIf="i < selectCategoriaItem.value.length - 1">, </ng-container>
                                    </span>
                                </ng-container>
                            </mat-select-trigger>
                            <app-selectAll [model]="filtroProductoForm.get('categoria')" [values]="allCategoriaSource">
                            </app-selectAll>
                            <mat-option *ngFor="let option of allCategoriaSource" [value]="option">
                                <span class="color-indicator" [style.backgroundColor]="option.color"></span>
                                {{option.nombre }}</mat-option>

                        </mat-select>
                    </mat-form-field>

                    <!-- Marcas -->
                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Marcas</mat-label>
                        <mat-select [formControlName]="'marca'" multiple #selectMarcaItem>
                            <mat-select-trigger>
                                <ng-container *ngIf="selectMarcaItem.value?.length > 0">
                                    <span *ngFor="let categoria of selectMarcaItem.value; let i = index">
                                        <span class="color-indicator" [style.backgroundColor]="categoria?.color"></span>
                                        {{ categoria.nombre || '' }}<ng-container
                                            *ngIf="i < selectMarcaItem.value.length - 1">, </ng-container>
                                    </span>
                                </ng-container>
                            </mat-select-trigger>
                            <app-selectAll [model]="filtroProductoForm.get('marca')" [values]="allMarcaSource">
                            </app-selectAll>
                            <mat-option *ngFor="let option of allMarcaSource" [value]="option">
                                <span class="color-indicator" [style.backgroundColor]="option.color"></span>
                                {{option.nombre }}</mat-option>

                        </mat-select>
                    </mat-form-field>

                    <!-- Fecha Registro Inicio -->
                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Fecha Registro Inicio</mat-label>
                        <input [min]="minDate" [max]="maxDate" (click)="pickerInicio.open()" autocomplete="off" matInput
                            [matDatepicker]="pickerInicio" [formControlName]="'fechaRegistroInicio'">
                        <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
                        <mat-datepicker #pickerInicio></mat-datepicker>
                    </mat-form-field>

                    <!-- Fecha Registro Fin -->
                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Fecha Registro Fin</mat-label>
                        <input [min]="minDate" [max]="maxDate" (click)="pickerFin.open()" autocomplete="off" matInput
                            [matDatepicker]="pickerFin" [formControlName]="'fechaRegistroFin'">
                        <mat-datepicker-toggle matSuffix [for]="pickerFin"></mat-datepicker-toggle>
                        <mat-datepicker #pickerFin></mat-datepicker>
                    </mat-form-field>

                    <!-- Precio Compra Inicio -->
                    <mat-form-field class="w-full " [appearance]="'outline'">
                        <mat-label>Precio Compra Inicio</mat-label>
                        <input autocomplete="off" matInput appTwoDigitDecimaNumber formControlName="precioCompraInicio">
                    </mat-form-field>
                    <!-- Precio Compra Fin -->
                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Precio Compra Fin</mat-label>
                        <input autocomplete="off" matInput appTwoDigitDecimaNumber formControlName="precioCompraFin">
                    </mat-form-field>

                    <!-- Precio Venta Inicio -->
                    <mat-form-field class="w-full " [appearance]="'outline'">
                        <mat-label>Precio Venta Inicio</mat-label>
                        <input autocomplete="off" matInput appTwoDigitDecimaNumber formControlName="precioVentaInicio">
                    </mat-form-field>
                    <!-- Precio Venta Fin -->
                    <mat-form-field class="w-full" [appearance]="'outline'">
                        <mat-label>Precio Venta Fin</mat-label>
                        <input autocomplete="off" matInput appTwoDigitDecimaNumber formControlName="precioVentaFin">
                    </mat-form-field>

                    <button class="mt-4 mb-8" mat-flat-button [color]="'primary'" (click)="btnBuscar()"
                        [disabled]="filtroProductoForm.invalid || disabledBuscar">
                        <mat-icon *ngIf="!disabledBuscar" class="icon-size-2"
                            [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                        <span class="ml-2" *ngIf="!disabledBuscar">Buscar</span>
                        <mat-progress-spinner *ngIf="disabledBuscar" [diameter]="24" [mode]="'indeterminate'">
                        </mat-progress-spinner>
                    </button>
                </form>

            </div>
        </div>
    </mat-drawer>
    <!-- Content -->
    <mat-drawer-content class="flex flex-col">
        <div class="flex flex-col flex-auto w-full">
            <div class="flex flex-wrap w-full  mx-auto p-6 md:p-8">
                <!-- Title and action buttons -->
                <div class="flex items-center justify-between w-full">

                    <div class="flex-1 min-w-0">
                        <!-- Title -->
                        <div class="mt-2">
                            <h2 class="text-2xl md:text-2xl font-semibold tracking-tight leading-8">Lista de Productos
                            </h2>
                        </div>
                        <!-- Breadcrumbs -->
                        <div class="flex flex-wrap items-center font-medium">
                            <div>
                                <a class="whitespace-nowrap text-primary-500">Productos</a>
                            </div>
                            <div class="flex items-center ml-1 whitespace-nowrap">
                                <mat-icon class="icon-size-5 text-secondary"
                                    [svgIcon]="'heroicons_mini:chevron-right'"></mat-icon>
                                <a class="ml-1 text-primary-500">Lista de Productos</a>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center ml-6">
                        @if (isMobilSize()) {
                        <!-- Actions menu (visible on xs) -->
                        <button [matMenuTriggerFor]="actionsMenu" mat-icon-button>
                            <mat-icon [svgIcon]="'heroicons_mini:ellipsis-vertical'"></mat-icon>
                        </button>
                        <mat-menu #actionsMenu="matMenu">
                            <button mat-menu-item (click)="onShowFormRegistrarProducto()">
                                <mat-icon [svgIcon]="'heroicons_solid:plus'"></mat-icon>
                                <span class="ml-1">Nuevo</span>
                            </button>
                            <button mat-menu-item (click)="matDrawer.open()">
                                <mat-icon [svgIcon]="'heroicons_solid:adjustments-horizontal'"></mat-icon>
                                <span class="ml-1">Filtrar</span>
                            </button>
                            <button mat-menu-item [disabled]="disabledExportar" (click)="onExportar()">
                                <mat-icon [svgIcon]="'heroicons_solid:arrow-up-tray'"></mat-icon>
                                <span class="ml-1">Exportar</span>
                            </button>
                        </mat-menu>
                        } @else {
                        <button class="hidden sm:inline-flex ml-3 sm:w-40 sm:h-10 sm:items-center sm:justify-center"
                            mat-flat-button [color]="'primary'" (click)="onShowFormRegistrarProducto()"
                            [color]="'primary'">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:plus'"></mat-icon>
                            <span class="ml-2">Nuevo</span>
                        </button>
                        <button class="hidden sm:inline-flex ml-3 sm:w-40 sm:h-10 sm:items-center sm:justify-center"
                            mat-stroked-button (click)="matDrawer.open()">
                            <mat-icon class="icon-size-5"
                                [svgIcon]="'heroicons_solid:adjustments-horizontal'"></mat-icon>
                            <span class="ml-2">Filtrar</span>
                        </button>
                        <button class="hidden sm:inline-flex ml-3 sm:w-40 sm:h-10 sm:items-center sm:justify-center"
                            mat-stroked-button [disabled]="disabledExportar" (click)="onExportar()">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:arrow-up-tray'"></mat-icon>
                            <span class="ml-2">Exportar</span>
                        </button>
                        }

                    </div>
                </div>
                <div class="w-full">

                    <div class="skeleton-default  bg-card shadow rounded-2xl overflow-hidden " *ngIf="skeleton">
                        <ngx-skeleton-loader [count]="skeletonNumber"
                            [theme]="{ 'border-radius': '0', height: '50px' }"></ngx-skeleton-loader>
                    </div>

                    <div class="grid grid-cols-1 xl:grid-cols-1 gap-8 w-full mt-6">

                        <!-- Tabla -->
                        <div class="xl:col-span-1 flex flex-col flex-auto bg-card shadow rounded-2xl overflow-hidden"
                            *ngIf="!skeleton">
                            <div class="overflow-x-auto mx-6">
                                <table class="w-full bg-transparent mb-3" mat-table matSort [dataSource]="pageSlice"
                                    [trackBy]="trackByFn" >


                                    <!-- Imagen del producto -->
                                    <ng-container matColumnDef="foto">
                                        <th mat-header-cell *matHeaderCellDef>Imagen</th>
                                        <td mat-cell *matCellDef="let producto" class="min-w-10">
                                            <div class="flex items-center">
                                                <div
                                                    class="relative flex items-center justify-center w-12 h-12 mr-6 rounded overflow-hidden border">
                                                    <img *ngIf="producto.urlFoto" [alt]="'Imagen de ' + producto.nombre"
                                                        [src]="producto.urlFoto" class="w-full h-full object-cover">
                                                    <div *ngIf="!producto.urlFoto"
                                                        class="flex items-center justify-center w-full h-full text-xs font-semibold leading-none text-center uppercase bg-gray-200">
                                                        SIN IMAGEN
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <!-- Código -->
                                    <ng-container matColumnDef="codigo">
                                        <th mat-header-cell mat-sort-header *matHeaderCellDef>
                                            Código
                                        </th>
                                        <td mat-cell *matCellDef="let producto" class="min-w-10">
                                            <span class="pr-2 whitespace-nowrap">
                                                <span>{{producto.codigo}}</span>
                                            </span>
                                        </td>
                                    </ng-container>

                        <!-- Nombre -->
                        <ng-container matColumnDef="nombre">
                            <th mat-header-cell mat-sort-header *matHeaderCellDef>
                                Nombre
                            </th>
                            <td mat-cell *matCellDef="let producto" class="min-w-30">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 rounded-full"
                                        [style.backgroundColor]="producto.color"></span>
                                    <span class="ml-3 leading-4">{{producto.nombre}}</span>
                                </span>
                            </td>
                        </ng-container>

                                    <!-- Marca -->
                                    <ng-container matColumnDef="marca">
                                        <th mat-header-cell mat-sort-header *matHeaderCellDef>
                                            Marca
                                        </th>
                                        <td mat-cell *matCellDef="let producto" class="min-w-30">
                                            <span class="flex items-center">
                                                <span class="w-2 h-2 rounded-full"
                                                    [style.backgroundColor]="producto.marca.color"></span>
                                                <span class="ml-3 leading-4">{{producto.marca.nombre}}</span>
                                            </span>
                                        </td>
                                    </ng-container>

                                    <!-- Categoría -->
                                    <ng-container matColumnDef="categoria">
                                        <th mat-header-cell mat-sort-header *matHeaderCellDef>
                                            Categoría
                                        </th>
                                        <td mat-cell *matCellDef="let producto" class="min-w-30">
                                            <span class="flex items-center">
                                                <span class="w-2 h-2 rounded-full"
                                                    [style.backgroundColor]="producto.categoria.color"></span>
                                                <span class="ml-3 leading-4">{{producto.categoria.nombre}}</span>
                                            </span>
                                        </td>
                                    </ng-container>

                                    <!-- Stock -->
                                    <ng-container matColumnDef="stock">
                                        <th mat-header-cell mat-sort-header *matHeaderCellDef class="text-center">
                                            Stock
                                        </th>
                                        <td mat-cell *matCellDef="let producto" class="min-w-10 text-center">
                                            <span
                                                class="inline-flex items-center font-bold text-xs px-2.5 py-0.5 rounded-full tracking-wide uppercase"
                                                [ngClass]="{'bg-red-200 text-red-800 dark:bg-red-600 dark:text-red-50': producto?.stock <= 0,
                                            'bg-orange-200 text-orange-800 dark:bg-orange-600 dark:text-orange-50': producto?.stock > 0 && producto?.stock <= 5,
                                            'bg-green-200 text-green-800 dark:bg-green-600 dark:text-green-50': producto?.stock > 5
                                            }"> <span
                                                    class="leading-relaxed whitespace-nowrap">{{producto?.stock}}</span>
                                            </span>
                                        </td>
                                    </ng-container>



                                    <!-- Precio Compra -->
                                    <ng-container matColumnDef="precioCompra">
                                        <th mat-header-cell mat-sort-header *matHeaderCellDef class="min-w-10"> Precio
                                            Compra</th>
                                        <td mat-cell *matCellDef="let producto">
                                            <span style="color: #056DB6;" class="pr-6 w-auto h-auto rounded-full">
                                                {{ producto.precioCompra |
                                                currency:monedaInfo.codigoMoneda:'code':'':
                                                monedaInfo.cultureInfo }}
                                            </span>
                                        </td>
                                    </ng-container>

                                    <!--  Precio Venta -->
                                    <ng-container matColumnDef="precioVenta">
                                        <th mat-header-cell mat-sort-header *matHeaderCellDef> Precio Venta</th>
                                        <td mat-cell *matCellDef="let producto">
                                            <span style="color: #056DB6;" class="pr-2 w-auto h-auto rounded-full">
                                                {{ producto.precioVenta |
                                                currency:monedaInfo.codigoMoneda:'code':'':
                                                monedaInfo.cultureInfo }}
                                            </span>
                                        </td>
                                    </ng-container>

                                    <!-- Fecha Registro -->
                                    <ng-container matColumnDef="fechaRegistro">
                                        <th mat-header-cell mat-sort-header *matHeaderCellDef>
                                            Fecha Registro
                                        </th>
                                        <td mat-cell *matCellDef="let producto" style="min-width: 180px">
                                            <span>
                                                {{producto.fechaRegistro | date:'dd/MM/yyyy HH:mm'}}
                                            </span>
                                        </td>
                                    </ng-container>

                                    <!-- Activar/Desactivar -->
                                    <ng-container matColumnDef="activarDesactivar">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Activo</th>
                                        <td mat-cell *matCellDef="let producto">
                                            <mat-slide-toggle [checked]="producto.activo" color="primary"
                                                (change)="UpdateActivoProductoAsync(producto, $event.checked)"
                                                [disabled]="disabledAcciones">
                                            </mat-slide-toggle>
                                        </td>
                                    </ng-container>

                                    <!-- Acciones -->
                                    <ng-container matColumnDef="acciones">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Acciones </th>
                                        <td mat-cell *matCellDef="let element">
                                            <button mat-icon-button [matMenuTriggerFor]="menu"
                                                [disabled]="disabledAcciones">
                                                <mat-icon>more_vert</mat-icon>
                                            </button>
                                            <mat-menu #menu="matMenu">
                                                <button mat-menu-item (click)="onShowFormDetalleProducto(element)">
                                                    <mat-icon svgIcon="feather:eye"></mat-icon> Ver
                                                </button>
                                                <button mat-menu-item (click)="onShowFormModificaProducto(element)">
                                                    <mat-icon svgIcon="feather:edit-2"></mat-icon> Editar
                                                </button>
                                                <button mat-menu-item (click)="DeleteAsync(element)">
                                                    <mat-icon svgIcon="feather:trash-2"></mat-icon> Eliminar
                                                </button>
                                            </mat-menu>
                                        </td>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="productoTableColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: productoTableColumns;"></tr>
                                </table>
                            </div>

                            <div class="paginator" *ngIf="allProductoDataSource.data.length > 0">
                                <mat-paginator #paginator [length]="allProductoDataSource.data.length" [pageSize]="10"
                                    [pageSizeOptions]="[10, 15, 20]" aria-label="Seleccione página"
                                    (page)="onPageChange($event)">
                                </mat-paginator>
                            </div>
                            <div class="paginator" *ngIf="allProductoDataSource.data.length === 0">
                                <img [src]="imgNoDataUltimosRegistros" alt="No hay datos disponibles"
                                    class="w-72 mx-auto mt-2" />
                                <div
                                    class="mt-4 sm:mt-8 text-2xl md:text-2xl font-semibold tracking-tight leading-tight md:leading-none text-center">
                                    {{textoResultadoTable}}</div>
                                <div>
                                    <p class="mt-2 text-gray-500 text-center">Aplique otros filtros de búsqueda</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </mat-drawer-content>
</mat-drawer-container>